<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mi Panel - Bienestar APS</title>
    <link rel="stylesheet" href="../css/styles.css">
</head>
<body>
    <!-- Header con usuario logueado -->
    <header class="header">
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <a href="../index.html">
                      <img src="../assets/images/logo-bienestar.png" alt="Logo Bienestar APS" style="height:120px; width:auto;">
                    </a>
                </div>
                <nav class="user-nav">
                    <div class="user-info">
                        <span class="user-name" id="usuario-nombre-header"></span>
                        <span class="user-rut" id="usuario-rut-header"></span>
                    </div>
                    <button class="btn btn-logout" onclick="logout()">Cerrar Sesi√≥n</button>
                </nav>
            </div>
        </div>
    </header>
    <!-- Navegaci√≥n Dashboard -->
    <nav class="dashboard-nav">
        <div class="container">
            <ul class="nav-tabs">
                <li class="nav-tab active" data-tab="resumen">üìä Resumen</li>
                <li class="nav-tab" data-tab="beneficios">üí∞ Mis Beneficios</li>
                <li class="nav-tab" data-tab="convenios">üè™ Mis Convenios</li>
                <li class="nav-tab" data-tab="compras-gas">üõí Compra de Gas</li>
                <li class="nav-tab" data-tab="solicitudes">üìù Solicitudes</li>
                <li class="nav-tab" data-tab="perfil">‚öôÔ∏è Mi Perfil</li>
            </ul>
        </div>
    </nav>
    <!-- Contenido del Dashboard -->
    <section class="dashboard-content">
        <div class="container">
            <!-- Tab: Resumen -->
            <div class="tab-content active" id="tab-resumen">
                <div class="welcome-banner">
                    <h1 id="bienvenida-usuario"></h1>
                    <p>Aqu√≠ puedes gestionar tus beneficios y convenios</p>
                </div>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon">üí∞</div>
                        <div class="stat-info">
                            <h3 id="beneficios-recibidos"></h3>
                            <p>Beneficios recibidos</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">üè™</div>
                        <div class="stat-info">
                            <h3 id="convenios-disponibles"></h3>
                            <p>Convenios disponibles</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">üìù</div>
                        <div class="stat-info">
                            <h3 id="solicitudes-pendientes"></h3>
                            <p>Solicitudes pendientes</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">‚úÖ</div>
                        <div class="stat-info">
                            <h3 id="tiempo-afiliacion"></h3>
                            <p>Tiempo de afiliaci√≥n</p>
                        </div>
                    </div>
                </div>
                <!-- Pr√≥ximos Beneficios -->
                <div class="section-card">
                    <h2>üìÖ Pr√≥ximos Beneficios</h2>
                    <div class="timeline" id="proximos-beneficios"></div>
                </div>
                <!-- Notificaciones -->
                <div class="section-card">
                    <h2>üîî Notificaciones Recientes</h2>
                    <div class="notifications" id="notificaciones-recientes"></div>
                </div>
            </div>
            <!-- Tab: Mis Beneficios -->
            <div class="tab-content" id="tab-beneficios">
                <h2>üí∞ Beneficios Recibidos</h2>
                <div class="benefits-table">
                    <table>
                        <thead>
                            <tr>
                                <th>Fecha</th>
                                <th>Beneficio</th>
                                <th>Monto</th>
                                <th>Estado</th>
                                <th>Comprobante</th>
                            </tr>
                        </thead>
                        <tbody id="tabla-beneficios">
                        </tbody>
                    </table>
                </div>
                <div class="total-benefits">
                    <h3>Total Beneficios: <span class="highlight" id="total-beneficios"></span></h3>
                </div>
            </div>
            <!-- Tab: Mis Convenios -->
            <div class="tab-content" id="tab-convenios">
                <h2>üè™ Convenios Activos</h2>
                <div class="convenios-favoritos">
                    <h3>‚≠ê Mis Convenios Favoritos</h3>
                    <div class="convenios-grid-small" id="convenios-favoritos"></div>
                </div>
                <div class="section-card">
                    <button class="btn btn-primary" onclick="location.href='convenios.html'">
                        Ver Todos los Convenios
                    </button>
                </div>
            </div>
            <div class="tab-content" id="tab-compras-gas">
                <h2>üõí Compra de Vales de Gas</h2>
                <form id="formCompraGas" enctype="multipart/form-data">
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="emailGas">Correo Electr√≥nico</label>
                            <input type="email" id="emailGas" name="emailGas" required>
                        </div>
                        <div class="form-group">
                            <label for="fechaCompraGas">Fecha de compra</label>
                            <input type="text" id="fechaCompraGas" name="fechaCompraGas" readonly>
                        </div>
                        <div class="form-group">
                            <label for="rutGas">Rut</label>
                            <input type="text" id="rutGas" name="rutGas" required>
                        </div>
                        <div class="form-group">
                            <label for="nombreGas">Nombre y Apellido Afiliado</label>
                            <input type="text" id="nombreGas" name="nombreGas" required>
                        </div>
                        <div class="form-group">
                            <label for="telefonoGas">Tel√©fono</label>
                            <input type="tel" id="telefonoGas" name="telefonoGas" required>
                        </div>
                        <div class="form-group">
                            <label>Compra Lipigas</label>
                            <select id="compraLipigas" name="compraLipigas">
                                <option value="no">No</option>
                                <option value="si">S√≠</option>
                            </select>
                        </div>
                        <div id="lipigasOpciones" style="display:none;">
                            <div class="form-group">
                                <label for="tipoLipigas">Tipo de carga Lipigas</label>
                                <select id="tipoLipigas" name="tipoLipigas">
                                    <option value="5">5 kg</option>
                                    <option value="11">11 kg</option>
                                    <option value="15">15 kg</option>
                                    <option value="45">45 kg</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="cantidadLipigas">Cantidad (m√°x 2/cupon, 4 mensual)</label>
                                <input type="number" id="cantidadLipigas" name="cantidadLipigas" min="0" max="4">
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Compra Abastible</label>
                            <select id="compraAbastible" name="compraAbastible">
                                <option value="no">No</option>
                                <option value="si">S√≠</option>
                            </select>
                        </div>
                        <div id="abastibleOpciones" style="display:none;">
                            <div class="form-group">
                                <label for="tipoAbastible">Tipo de carga Abastible</label>
                                <select id="tipoAbastible" name="tipoAbastible">
                                    <option value="5">5 kg</option>
                                    <option value="11">11 kg</option>
                                    <option value="15">15 kg</option>
                                    <option value="45">45 kg</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="cantidadAbastible">Cantidad (m√°x 2/cupon, 4 mensual)</label>
                                <input type="number" id="cantidadAbastible" name="cantidadAbastible" min="0" max="4">
                            </div>
                            <div class="form-group">
                                <label for="saldoFavor">Saldo a favor (si aplica)</label>
                                <input type="text" id="saldoFavor" name="saldoFavor" placeholder="Fecha y monto">
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="comprobanteGas">Adjuntar comprobante de transferencia</label>
                            <input type="file" id="comprobanteGas" name="comprobanteGas" required>
                            <small>Recuerde que el asunto debe indicar cantidad y carga de gas (5k-11k-15k-45k).</small>
                        </div>
                    </div>
                    <button type="submit" class="btn btn-primary">Enviar Compra</button>
                </form>
            </div>
            <!-- Tab: Solicitudes -->
            <div class="tab-content" id="tab-solicitudes">
                <h2>üìù Mis Solicitudes</h2>
                <div class="actions-bar">
                    <button class="btn btn-primary" onclick="nuevaSolicitud()">
                        ‚ûï Nueva Solicitud
                    </button>
                </div>
                <div class="solicitudes-list" id="mis-solicitudes"></div>
            </div>
            <!-- Tab: Mi Perfil -->
            <div class="tab-content" id="tab-perfil">
                <h2>‚öôÔ∏è Mi Perfil</h2>
                <div class="profile-grid">
                    <div class="profile-card">
                        <h3>Informaci√≥n Personal</h3>
                        <form class="profile-form">
                            <div class="form-group">
                                <label>Nombre Completo</label>
                                <input type="text" id="perfil-nombre" readonly>
                            </div>
                            <div class="form-group">
                                <label>RUT</label>
                                <input type="text" id="perfil-rut" readonly>
                            </div>
                            <div class="form-group">
                                <label>Email</label>
                                <input type="email" id="perfil-email">
                            </div>
                            <div class="form-group">
                                <label>Tel√©fono</label>
                                <input type="tel" id="perfil-telefono">
                            </div>
                            <button type="submit" class="btn btn-primary">Actualizar Informaci√≥n</button>
                        </form>
                    </div>
                    <div class="profile-card">
                        <h3>Cambiar Contrase√±a</h3>
                        <form class="profile-form">
                            <div class="form-group">
                                <label>Contrase√±a Actual</label>
                                <input type="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                            </div>
                            <div class="form-group">
                                <label>Nueva Contrase√±a</label>
                                <input type="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                            </div>
                            <div class="form-group">
                                <label>Confirmar Contrase√±a</label>
                                <input type="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                            </div>
                            <button type="submit" class="btn btn-primary">Cambiar Contrase√±a</button>
                        </form>
                    </div>
                    <div class="profile-card">
                        <h3>Informaci√≥n de Cuenta</h3>
                        <div class="info-list">
                            <div class="info-item">
                                <span class="info-label">Fecha de afiliaci√≥n:</span>
                                <span class="info-value" id="perfil-fecha-afiliacion"></span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">Centro de Salud:</span>
                                <span class="info-value" id="perfil-centro-salud"></span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">Cargas familiares:</span>
                                <span class="info-value" id="perfil-cargas"></span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">Estado:</span>
                                <span class="badge success" id="perfil-estado"></span>
                            </div>
                        </div>
                        <button class="btn btn-secondary">Ver Cargas Familiares</button>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <p>&copy; 2025 Servicio Bienestar APS - Corporaci√≥n Municipal de Puente Alto</p>
        </div>
    </footer>
    <!-- JS Din√°mico: todos los datos se llenan desde JS, nada est√° fijo en el HTML -->
    <script>
    // Aqu√≠ debes obtener los datos del usuario desde tu backend/Firebase y llenar los campos
    // Ejemplo de estructura, reemplaza por tu l√≥gica real:
    const usuario = {
        nombre: "",
        genero: "",
        rut: "",
        fechaAfiliacion: "",
        centroSalud: "",
        cargas: "",
        estado: "",
        email: "",
        telefono: "",
        beneficiosRecibidos: "",
        conveniosDisponibles: "",
        solicitudesPendientes: "",
        beneficios: [],
        totalBeneficios: "",
        proximosBeneficios: [],
        notificaciones: [],
        conveniosFavoritos: [],
        solicitudes: []
    };
    function calcularTiempoAfiliacion(fechaAfiliacion) {
        if(!fechaAfiliacion) return "";
        const [dia, mes, a√±o] = fechaAfiliacion.split('/');
        const fechaInicio = new Date(`${a√±o}-${mes}-${dia}`);
        const hoy = new Date();
        const msPorMes = 1000 * 60 * 60 * 24 * 30.44;
        const meses = Math.floor((hoy - fechaInicio) / msPorMes);
        return meses + (meses === 1 ? " mes" : " meses");
    }
    function bienvenida(nombre, genero) {
        if(!nombre) return "";
        const primerNombre = nombre.split(" ")[0];
        if (genero === "F") {
            return `¬°Bienvenida, ${primerNombre}!`;
        } else {
            return `¬°Bienvenido, ${primerNombre}!`;
        }
    }
    function formateaFecha(fechaStr) {
        if (!fechaStr) return "";
        const meses = ["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"];
        const [a√±o, mes] = fechaStr.split("-");
        return `${meses[parseInt(mes,10)-1]} ${a√±o}`;
    }
    document.addEventListener('DOMContentLoaded', function() {
        // Aqu√≠ debes llenar usuario con datos reales
        // Ejemplo de llenado:
        // usuario.nombre = "Camila Gonz√°lez";
        // usuario.genero = "F";
        // usuario.rut = "22.222.222-2";
        // usuario.fechaAfiliacion = "14/05/2025";
        // usuario.centroSalud = "CESFAM Karol Wojtyla";
        // usuario.cargas = "3";
        // usuario.estado = "Activo";
        // usuario.email = "camila@salud.cl";
        // usuario.telefono = "+56 9 1234 5678";
        // usuario.beneficiosRecibidos = 135000;
        // usuario.conveniosDisponibles = 12;
        // usuario.solicitudesPendientes = 2;
        // usuario.beneficios = [...];
        // usuario.totalBeneficios = 175000;
        // usuario.proximosBeneficios = [...];
        // usuario.notificaciones = [...];
        // usuario.conveniosFavoritos = [...];
        // usuario.solicitudes = [...];

        document.getElementById('usuario-nombre-header').textContent = usuario.nombre ? `üë§ ${usuario.nombre}` : "";
        document.getElementById('usuario-rut-header').textContent = usuario.rut ? `RUT: ${usuario.rut}` : "";

        document.getElementById('bienvenida-usuario').textContent = bienvenida(usuario.nombre, usuario.genero);

        document.getElementById('beneficios-recibidos').textContent = usuario.beneficiosRecibidos ? `$${usuario.beneficiosRecibidos.toLocaleString("es-CL")}` : "";
        document.getElementById('convenios-disponibles').textContent = usuario.conveniosDisponibles || "";
        document.getElementById('solicitudes-pendientes').textContent = usuario.solicitudesPendientes || "";
        document.getElementById('tiempo-afiliacion').textContent = calcularTiempoAfiliacion(usuario.fechaAfiliacion);

        // Pr√≥ximos beneficios
        const listaBeneficios = (usuario.proximosBeneficios || [])
            .filter(b => new Date(b.fecha) > new Date())
            .map(b => `<div class="timeline-item">
                <div class="timeline-date">${formateaFecha(b.fecha)}</div>
                <div class="timeline-content">
                    <h4>${b.nombre}</h4>
                    <p>$${b.monto ? b.monto.toLocaleString("es-CL") : ""} - Se depositar√° en tu cuenta bancaria</p>
                </div>
            </div>`).join('');
        document.getElementById('proximos-beneficios').innerHTML = listaBeneficios;

        // Notificaciones
        const notifLista = (usuario.notificaciones || []).map(n =>
            `<div class="notification ${n.nueva ? "new" : ""}">
                ${n.nueva ? '<span class="notification-badge">Nuevo</span>' : ""}
                <p><strong>${n.titulo || ""}</strong> ${n.mensaje || ""}</p>
                <span class="notification-date">${n.fecha || ""}</span>
            </div>`
        ).join('');
        document.getElementById('notificaciones-recientes').innerHTML = notifLista;

        // Beneficios recibidos (tabla)
        const tablaBeneficios = (usuario.beneficios || []).map(b =>
            `<tr>
                <td>${b.fecha || ""}</td>
                <td>${b.nombre || ""}</td>
                <td>$${b.monto ? b.monto.toLocaleString("es-CL") : ""}</td>
                <td><span class="badge ${b.estadoClass || ""}">${b.estado || ""}</span></td>
                <td><button class="btn-small">${b.comprobanteIcon || ""} Ver</button></td>
            </tr>`
        ).join('');
        document.getElementById('tabla-beneficios').innerHTML = tablaBeneficios;
        document.getElementById('total-beneficios').textContent = usuario.totalBeneficios ? `$${usuario.totalBeneficios.toLocaleString("es-CL")}` : "";

        // Convenios favoritos
        document.getElementById('convenios-favoritos').innerHTML = (usuario.conveniosFavoritos || []).map(c =>
            `<div class="convenio-card-small">
                <div class="convenio-icon">${c.icono || ""}</div>
                <h4>${c.nombre || ""}</h4>
                <p>${c.descripcion || ""}</p>
                <button class="btn-small btn-primary">Ver Detalles</button>
            </div>`
        ).join('');

        // Solicitudes
        document.getElementById('mis-solicitudes').innerHTML = (usuario.solicitudes || []).map(s =>
            `<div class="solicitud-item">
                <div class="solicitud-header">
                    <h3>${s.titulo || ""}</h3>
                    <span class="badge ${s.estadoClass || ""}">${s.estado || ""}</span>
                </div>
                <div class="solicitud-body">
                    <p><strong>Fecha de solicitud:</strong> ${s.fecha || ""}</p>
                    <p><strong>Monto:</strong> $${s.monto ? s.monto.toLocaleString("es-CL") : ""}</p>
                    <p><strong>Estado:</strong> ${s.detalleEstado || ""}</p>
                </div>
                <div class="solicitud-footer">
                    <button class="btn-small">Ver Detalles</button>
                    ${s.permiteAdjuntar ? '<button class="btn-small btn-secondary">Adjuntar Documentos</button>' : ''}
                </div>
            </div>`
        ).join('');

        // Perfil
        document.getElementById('perfil-nombre').value = usuario.nombre || "";
        document.getElementById('perfil-rut').value = usuario.rut || "";
        document.getElementById('perfil-email').value = usuario.email || "";
        document.getElementById('perfil-telefono').value = usuario.telefono || "";
        document.getElementById('perfil-fecha-afiliacion').textContent = usuario.fechaAfiliacion || "";
        document.getElementById('perfil-centro-salud').textContent = usuario.centroSalud || "";
        document.getElementById('perfil-cargas').textContent = usuario.cargas || "";
        document.getElementById('perfil-estado').textContent = usuario.estado || "";
    });
    function logout() {
        alert("Sesi√≥n cerrada");
        location.href = "../index.html";
    }
    </script>
</body>
</html>

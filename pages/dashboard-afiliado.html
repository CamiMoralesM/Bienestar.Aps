<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel Administrativo - Bienestar APS</title>
    <link rel="stylesheet" href="../css/styles.css">
    <!-- Agregar esta l√≠nea en el <head> de dashboard-admin.html -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
</head>
<body>
    <!-- Header Admin -->
    <header class="header admin-header">
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <a href="../index.html">
                      <img src="../assets/images/logo-bienestar.png" alt="Logo Bienestar APS" style="height:120px; width:auto;">
                    </a>
                    <span class="admin-badge">ADMIN</span>
                </div>
                <nav class="user-nav">
                    <div class="user-info">
                        <span class="user-name">üîê Administrador</span>
                        <span class="user-rut">Panel de Control</span>
                    </div>
                    <button class="btn btn-logout" onclick="logout()">Cerrar Sesi√≥n</button>
                </nav>
            </div>
        </div>
    </header>

    <!-- Navegaci√≥n Admin -->
    <nav class="dashboard-nav admin-nav">
        <div class="container">
            <ul class="nav-tabs">
                <li class="nav-tab active" data-tab="dashboard">üìä Dashboard</li>
                <li class="nav-tab" data-tab="afiliados">üë• Afiliados</li>
                <li class="nav-tab" data-tab="solicitudes">üìù Solicitudes</li>
                <li class="nav-tab" data-tab="beneficios">üí∞ Beneficios</li>
                <li class="nav-tab" data-tab="convenios">üè™ Convenios</li>
                <li class="nav-tab" data-tab="compras-gas-admin">üõí Compras Gas</li>
                <li class="nav-tab" data-tab="reportes">üìà Reportes</li>
            </ul>
        </div>
    </nav>

    <!-- Contenido Admin -->
    <section class="dashboard-content admin-content">
        <div class="container">
            
            <!-- Tab: Dashboard -->
            <div class="tab-content active" id="tab-dashboard">
                <h1 class="page-title">Panel de Control Administrativo</h1>
                
                <!-- Estad√≠sticas Principales -->
                <div class="admin-stats-grid">
                    <div class="admin-stat-card card-primary">
                        <div class="stat-icon">üë•</div>
                        <div class="stat-info">
                            <h3>1,247</h3>
                            <p>Afiliados Activos</p>
                            <span class="stat-trend positive">+5% este mes</span>
                        </div>
                    </div>
                    <div class="admin-stat-card card-success">
                        <div class="stat-icon">üí∞</div>
                        <div class="stat-info">
                            <h3>$156.8M</h3>
                            <p>Beneficios Entregados 2025</p>
                            <span class="stat-trend positive">+12% vs 2024</span>
                        </div>
                    </div>
                    <div class="admin-stat-card card-warning">
                        <div class="stat-icon">üìù</div>
                        <div class="stat-info">
                            <h3>23</h3>
                            <p>Solicitudes Pendientes</p>
                            <span class="stat-trend negative">Requiere atenci√≥n</span>
                        </div>
                    </div>
                    <div class="admin-stat-card card-info">
                        <div class="stat-icon">üè™</div>
                        <div class="stat-info">
                            <h3>24</h3>
                            <p>Convenios Activos</p>
                            <span class="stat-trend neutral">2 por renovar</span>
                        </div>
                    </div>
                </div>

                <!-- Actividad Reciente -->
                <div class="admin-section">
                    <div class="section-header">
                        <h2>üìã Actividad Reciente</h2>
                        <button class="btn btn-small btn-secondary">Ver Todo</button>
                    </div>
                    <div class="activity-list">
                        <div class="activity-item">
                            <div class="activity-icon success">‚úì</div>
                            <div class="activity-content">
                                <p><strong>Solicitud Aprobada:</strong> Asignaci√≥n por Natalidad - Mar√≠a Gonz√°lez</p>
                                <span class="activity-time">Hace 10 minutos</span>
                            </div>
                        </div>
                        <div class="activity-item">
                            <div class="activity-icon info">üìÑ</div>
                            <div class="activity-content">
                                <p><strong>Nueva Solicitud:</strong> Pr√©stamo M√©dico - Carlos Soto</p>
                                <span class="activity-time">Hace 25 minutos</span>
                            </div>
                        </div>
                        <div class="activity-item">
                            <div class="activity-icon warning">‚ö†Ô∏è</div>
                            <div class="activity-content">
                                <p><strong>Alerta:</strong> Convenio por renovar - Gimnasios Energy</p>
                                <span class="activity-time">Hace 1 hora</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Gr√°ficos -->
                <div class="charts-grid">
                    <div class="chart-card">
                        <h3>üìä Beneficios por Mes (2025)</h3>
                        <div class="chart-placeholder">
                            <p>Gr√°fico de barras - Beneficios entregados mensualmente</p>
                            <small>Se integrar√≠a Chart.js aqu√≠</small>
                        </div>
                    </div>
                    <div class="chart-card">
                        <h3>üìà Crecimiento de Afiliados</h3>
                        <div class="chart-placeholder">
                            <p>Gr√°fico de l√≠neas - Evoluci√≥n de afiliados</p>
                            <small>Se integrar√≠a Chart.js aqu√≠</small>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Tab: Afiliados -->
            <div class="tab-content" id="tab-afiliados">
                <div class="section-header">
                    <h2>üë• Gesti√≥n de Afiliados</h2>
                    <button class="btn btn-primary" onclick="nuevoAfiliado()">
                        ‚ûï Nuevo Afiliado
                    </button>
                </div>

                <!-- Filtros y B√∫squeda -->
                <div class="admin-filters">
                    <input type="text" class="search-input" placeholder="üîç Buscar por nombre, RUT o centro de salud...">
                    <select class="filter-select" id="filtroEstado">
                        <option value="todos">Todos los estados</option>
                        <option value="activo">Activos</option>
                        <option value="inactivo">Inactivos</option>
                        <option value="pendiente">Pendientes</option>
                    </select>
                    <select class="filter-select" id="filtroCentro">
                        <option value="todos">Todos los centros</option>
                        <option value="CESFAM Karol Wojtyla">CESFAM Karol Wojtyla</option>
                        <option value="CESFAM Padre Manuel Villaseca">CESFAM Padre Manuel Villaseca</option>
                        <option value="CESFAM Alejandro del Rio">CESFAM Alejandro del Rio</option>
                        <option value="CESFAM Bernardo Leighton">CESFAM Bernardo Leighton</option>
                        <option value="CESFAM Cardenal Ra√∫l Silva Henr√≠quez">CESFAM Cardenal Ra√∫l Silva Henr√≠quez</option>
                        <option value="CESFAM Vista Hermosa">CESFAM Vista Hermosa</option>
                        <option value="CESFAM Laurita Vicu√±a">CESFAM Laurita Vicu√±a</option>
                        <option value="Centro de Im√°genes">Centro de Im√°genes</option>
                        <option value="Central de Ambulancia">Central de Ambulancia</option>
                        <option value="Administraci√≥n Salud">Administraci√≥n Salud</option>
                        <option value="San L√°zaro">San L√°zaro</option>
                        <option value="CEIF">CEIF</option>
                        <option value="Laboratorio Salud">Laboratorio Salud</option>
                    </select>
                    <button class="btn btn-secondary" onclick="exportarAfiliados()">üìä Exportar Excel</button>
                </div>

                <!-- Contador de resultados -->
                <div class="results-info">
                    <span class="afiliados-counter">Cargando afiliados...</span>
                </div>

                <!-- Tabla de Afiliados -->
                <div class="admin-table">
                    <table>
                        <thead>
                            <tr>
                                <th>RUT</th>
                                <th>Nombre</th>
                                <th>Centro de Salud</th>
                                <th>Fecha Afiliaci√≥n</th>
                                <th>Estado</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Los datos se cargan din√°micamente -->
                        </tbody>
                    </table>
                </div>

                <!-- Paginaci√≥n -->
                <div class="pagination">
                    <button class="btn-small">‚Üê Anterior</button>
                    <span>P√°gina 1 de 25</span>
                    <button class="btn-small">Siguiente ‚Üí</button>
                </div>
            </div>

            <!-- Tab: Solicitudes -->
            <div class="tab-content" id="tab-solicitudes">
                <div class="section-header">
                    <h2>üìù Gesti√≥n de Solicitudes</h2>
                    <div class="filter-pills">
                        <button class="pill active">Todas (23)</button>
                        <button class="pill">Pendientes (15)</button>
                        <button class="pill">En Revisi√≥n (5)</button>
                        <button class="pill">Aprobadas (3)</button>
                    </div>
                </div>

                <!-- Lista de Solicitudes Admin -->
                <div class="admin-solicitudes">
                    <!-- Las solicitudes se cargan din√°micamente -->
                </div>
            </div>

            <!-- Tab: Beneficios -->
            <div class="tab-content" id="tab-beneficios">
                <div class="section-header">
                    <h2>üí∞ Administraci√≥n de Beneficios</h2>
                    <button class="btn btn-primary">‚ûï Crear Beneficio</button>
                </div>

                <div class="beneficios-admin-grid">
                    <div class="beneficio-admin-card">
                        <h3>Bono Navidad 2025</h3>
                        <div class="beneficio-stats">
                            <div class="stat-item">
                                <span class="stat-label">Monto:</span>
                                <span class="stat-value">$60.000</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">Beneficiarios:</span>
                                <span class="stat-value">1,247</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">Total:</span>
                                <span class="stat-value highlight">$74.82M</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">Estado:</span>
                                <span class="badge info">Programado</span>
                            </div>
                        </div>
                        <div class="beneficio-actions">
                            <button class="btn btn-small">Editar</button>
                            <button class="btn btn-small btn-success">Procesar Pago</button>
                        </div>
                    </div>

                    <div class="beneficio-admin-card">
                        <h3>Bono Fiestas Patrias 2025</h3>
                        <div class="beneficio-stats">
                            <div class="stat-item">
                                <span class="stat-label">Monto:</span>
                                <span class="stat-value">$40.000</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">Beneficiarios:</span>
                                <span class="stat-value">1,198</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">Total:</span>
                                <span class="stat-value highlight">$47.92M</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">Estado:</span>
                                <span class="badge success">Pagado</span>
                            </div>
                        </div>
                        <div class="beneficio-actions">
                            <button class="btn btn-small">Ver Reporte</button>
                            <button class="btn btn-small btn-secondary">Descargar Excel</button>
                        </div>
                    </div>
                </div>
            </div>
            
<div class="tab-content" id="tab-compras-gas-admin">
    <h2>üõí Compras de Gas - Administraci√≥n</h2>
    <div class="compras-gas-admin-actions">
        <button class="btn btn-success" onclick="exportarLipigasExcel()">Descargar Lipigas Excel</button>
        <button class="btn btn-warning" onclick="exportarAbastibleExcel()">Descargar Abastible Excel</button>
        <button class="btn btn-info" onclick="exportarGeneralExcel()">Descargar General Excel</button>
    </div>
    <div id="listadoComprasGas">
        <!-- Aqu√≠ se despliega el listado de compras del d√≠a, separado por empresa -->
    </div>
</div>
            <!-- Tab: Convenios -->
            <div class="tab-content" id="tab-convenios">
                <div class="section-header">
                    <h2>üè™ Administraci√≥n de Convenios</h2>
                    <button class="btn btn-primary">‚ûï Nuevo Convenio</button>
                </div>

                <div class="convenios-admin-list">
                    <!-- Los convenios se cargan din√°micamente -->
                </div>
            </div>

            <!-- Tab: Reportes -->
            <div class="tab-content" id="tab-reportes">
                <h2>üìà Centro de Reportes</h2>
                
                <div class="reportes-grid">
                    <div class="reporte-card">
                        <h3>üìä Reporte de Beneficios</h3>
                        <p>Detalle de beneficios entregados por per√≠odo</p>
                        <div class="reporte-form">
                            <select>
                                <option>√öltimo mes</option>
                                <option>√öltimo trimestre</option>
                                <option>√öltimo a√±o</option>
                                <option>Personalizado</option>
                            </select>
                            <button class="btn btn-primary">Generar</button>
                        </div>
                    </div>

                    <div class="reporte-card">
                        <h3>üë• Reporte de Afiliados</h3>
                        <p>Listado completo de afiliados y su estado</p>
                        <div class="reporte-form">
                            <select>
                                <option>Todos los centros</option>
                                <option>CESFAM Karol Wojtyla</option>
                                <option>CESFAM Padre Manuel Villaseca</option>
                                <option>CESFAM Alejandro del Rio</option>
                            </select>
                            <button class="btn btn-primary">Generar</button>
                        </div>
                    </div>

                    <div class="reporte-card">
                        <h3>üí∞ Reporte Financiero</h3>
                        <p>Resumen de montos entregados y presupuesto</p>
                        <div class="reporte-form">
                            <select>
                                <option>2025</option>
                                <option>2024</option>
                                <option>2023</option>
                            </select>
                            <button class="btn btn-primary">Generar</button>
                        </div>
                    </div>

                    <div class="reporte-card">
                        <h3>üè™ Reporte de Convenios</h3>
                        <p>Uso y efectividad de convenios activos</p>
                        <div class="reporte-form">
                            <select>
                                <option>Todos los convenios</option>
                                <option>Salud</option>
                                <option>Educaci√≥n</option>
                            </select>
                            <button class="btn btn-primary">Generar</button>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </section>

    <!-- Modal Nuevo Afiliado -->
    <div id="modalNuevoAfiliado" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>‚ûï Nuevo Afiliado</h2>
                <span class="close" onclick="cerrarModal()">&times;</span>
            </div>
            <div class="modal-body">
                <form id="formNuevoAfiliado" onsubmit="crearNuevoAfiliado(event)">
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="nombre">Nombre Completo *</label>
                            <input type="text" name="nombre" id="nombre" required placeholder="Juan P√©rez G√≥mez">
                        </div>

                        <div class="form-group">
                            <label for="rut">RUT *</label>
                            <input type="text" name="rut" id="rut" required placeholder="12.345.678-9" maxlength="12">
                        </div>

                        <div class="form-group">
                            <label for="email">Correo Electr√≥nico *</label>
                            <input type="email" name="email" id="email" required placeholder="juan.perez@salud.cl">
                        </div>

                        <div class="form-group">
                            <label for="telefono">N√∫mero de Tel√©fono</label>
                            <input type="tel" name="telefono" id="telefono" placeholder="+56 9 1234 5678">
                        </div>

                        <div class="form-group">
                            <label for="centroSalud">Lugar de Trabajo *</label>
                            <select name="centroSalud" id="centroSalud" required>
                                <option value="">Seleccione...</option>
                                <option value="CESFAM Karol Wojtyla">CESFAM Karol Wojtyla</option>
                                <option value="CESFAM Padre Manuel Villaseca">CESFAM Padre Manuel Villaseca</option>
                                <option value="CESFAM Alejandro del Rio">CESFAM Alejandro del Rio</option>
                                <option value="CESFAM Bernardo Leighton">CESFAM Bernardo Leighton</option>
                                <option value="CESFAM Cardenal Ra√∫l Silva Henr√≠quez">CESFAM Cardenal Ra√∫l Silva Henr√≠quez</option>
                                <option value="CESFAM Vista Hermosa">CESFAM Vista Hermosa</option>
                                <option value="CESFAM Laurita Vicu√±a">CESFAM Laurita Vicu√±a</option>
                                <option value="Centro de Im√°genes">Centro de Im√°genes</option>
                                <option value="Central de Ambulancia">Central de Ambulancia</option>
                                <option value="Administraci√≥n Salud">Administraci√≥n Salud</option>
                                <option value="San L√°zaro">San L√°zaro</option>
                                <option value="CEIF">CEIF</option>
                                <option value="Laboratorio Salud">Laboratorio Salud</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="cargo">Cargo *</label>
                            <input type="text" name="cargo" id="cargo" required placeholder="Enfermero, T√©cnico, etc.">
                        </div>

                        <div class="form-group">
                            <label for="estadoCivil">Estado Civil</label>
                            <select name="estadoCivil" id="estadoCivil">
                                <option value="">Seleccione...</option>
                                <option value="Soltero/a">Soltero/a</option>
                                <option value="Casado/a">Casado/a</option>
                                <option value="Divorciado/a">Divorciado/a</option>
                                <option value="Viudo/a">Viudo/a</option>
                                <option value="Uni√≥n Civil">Uni√≥n Civil</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="password">Contrase√±a Temporal *</label>
                            <input type="password" name="password" id="password" required placeholder="M√≠nimo 6 caracteres" minlength="6">
                        </div>
                    </div>

                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" onclick="cerrarModal()">Cancelar</button>
                        <button type="submit" class="btn btn-primary">Crear Afiliado</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <p>&copy; 2025 Servicio Bienestar APS - Panel Administrativo</p>
        </div>
    </footer>
    
    <script type="module" src="../js/dashboard-admin-firebase.js"></script>
</body>
</html>

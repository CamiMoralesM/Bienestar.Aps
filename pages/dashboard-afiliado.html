<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mi Panel - Bienestar APS</title>
    <link rel="stylesheet" href="../css/styles.css">
</head>
<body>
    
    <header class="header">
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <a href="../index.html">
                      <img src="../assets/images/logo-bienestar.png" alt="Logo Bienestar APS" style="height:120px; width:auto;">
                    </a>
                </div>
                <nav class="user-nav">
                    <div class="user-info">
                        <span class="user-name"></span>
                        <span class="user-rut"></span>
                    </div>
                    <button class="btn btn-logout" onclick="logout()">Cerrar Sesi√≥n</button>
                </nav>
            </div>
        </div>
    </header>

    <nav class="dashboard-nav">
        <div class="container">
            <ul class="nav-tabs">
                <li class="nav-tab active" data-tab="resumen">üìä Resumen</li>
                <li class="nav-tab" data-tab="compras-gas">üõí Compra de Gas</li>
                <li class="nav-tab" data-tab="compra-cine">üé¨ Compra de Cine</li>
                <li class="nav-tab" data-tab="compra-jumper">ü§∏ Compra Jumper Park</li>
                <li class="nav-tab" data-tab="compra-gimnasio">üí™ Compra Gimnasio</li>
                <li class="nav-tab" data-tab="prestamos">üí∞ Pr√©stamos</li>
                <li class="nav-tab" data-tab="solicitudes">üìù Solicitudes</li>
                <li class="nav-tab" data-tab="perfil">‚öôÔ∏è Mi Perfil</li>
            </ul>
        </div>
    </nav>
 
    <!-- Contenido del Dashboard -->
    <section class="dashboard-content">
        <div class="container">
            <!-- Tab: Resumen -->
            <div class="tab-content active" id="tab-resumen">
                <div class="welcome-banner">
                    <h1 id="bienvenida-usuario"></h1>
                    <p>Aqu√≠ puedes gestionar tus beneficios y convenios</p>
                </div>
                <div class="stats-grid">
                    <!-- Solicitudes pendientes -->
                    <div class="stat-card">
                        <div class="stat-icon">üìù</div>
                        <div class="stat-info">
                            <h3 id="solicitudes-pendientes"></h3>
                            <p>Solicitudes pendientes</p>
                        </div>
                    </div>

                    <!-- Tiempo de afiliaci√≥n -->
                    <div class="stat-card">
                        <div class="stat-icon">‚úÖ</div>
                        <div class="stat-info">
                            <h3 id="tiempo-afiliacion"></h3>
                            <p>Tiempo de afiliaci√≥n</p>
                        </div>
                    </div>
                </div>
                <!-- Notificaciones -->
                <div class="section-card">
                    <h2>üîî Notificaciones Recientes</h2>
                    <div class="notifications" id="notificaciones-recientes"></div>
                </div>
            </div>

            <!-- Tab: Compra de Gas -->
            <div class="tab-content" id="tab-compras-gas">
                <h2>üõí Compra de Vales de Gas</h2>
                
                <div class="info-box" style="background: #ed9187; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                    <p><strong>üìã Informaci√≥n:</strong></p>
                    <ul style="margin: 10px 0; padding-left: 20px;">
                        <li>L√≠mites Mensuales</li>
                        <li>üî• Temporada Normal (Oct-May): M√°ximo 4 cargas mensuales, m√°ximo 2 por tipo</li>
                        <li>‚ùÑÔ∏è Temporada Alta (Jun-Sep): M√°ximo 6 cargas mensuales, m√°ximo 3 por tipo (45kg m√°x. 2)</li>
                    </ul>
                </div>
                
                <!-- Informaci√≥n de Precios -->
                <div class="info-precios-gas" style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 20px; margin-bottom: 30px;">
                    <!-- Precios Lipigas -->
                    <div class="info-box" style="background: linear-gradient(135deg, #ff6b6b 0%, #ee5a6f 100%); color: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 15px rgba(255, 107, 107, 0.3);">
                        <h3 style="margin: 0 0 15px 0; font-size: 1.3em; display: flex; align-items: center; gap: 10px;">
                            <span style="font-size: 1.5em;">üî•</span> Lipigas
                        </h3>
                        <div style="display: grid; gap: 10px;">
                            <div style="display: flex; justify-content: space-between; padding: 8px 12px; background: rgba(255, 255, 255, 0.2); border-radius: 6px;">
                                <span style="font-weight: 500;">5 kilos:</span>
                                <span style="font-weight: bold; font-size: 1.1em;">$7.000</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; padding: 8px 12px; background: rgba(255, 255, 255, 0.2); border-radius: 6px;">
                                <span style="font-weight: 500;">11 kilos:</span>
                                <span style="font-weight: bold; font-size: 1.1em;">$12.000</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; padding: 8px 12px; background: rgba(255, 255, 255, 0.2); border-radius: 6px;">
                                <span style="font-weight: 500;">15 kilos:</span>
                                <span style="font-weight: bold; font-size: 1.1em;">$16.000</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; padding: 8px 12px; background: rgba(255, 255, 255, 0.2); border-radius: 6px;">
                                <span style="font-weight: 500;">45 kilos:</span>
                                <span style="font-weight: bold; font-size: 1.1em;">$54.000</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Precios Abastible -->
                    <div class="info-box" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); color: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 15px rgba(79, 172, 254, 0.3);">
                        <h3 style="margin: 0 0 15px 0; font-size: 1.3em; display: flex; align-items: center; gap: 10px;">
                            <span style="font-size: 1.5em;">‚õΩ</span> Abastible
                        </h3>
                        <div style="display: grid; gap: 10px;">
                            <div style="display: flex; justify-content: space-between; padding: 8px 12px; background: rgba(255, 255, 255, 0.2); border-radius: 6px;">
                                <span style="font-weight: 500;">5 kilos:</span>
                                <span style="font-weight: bold; font-size: 1.1em;">$8.000</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; padding: 8px 12px; background: rgba(255, 255, 255, 0.2); border-radius: 6px;">
                                <span style="font-weight: 500;">11 kilos:</span>
                                <span style="font-weight: bold; font-size: 1.1em;">$15.000</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; padding: 8px 12px; background: rgba(255, 255, 255, 0.2); border-radius: 6px;">
                                <span style="font-weight: 500;">15 kilos:</span>
                                <span style="font-weight: bold; font-size: 1.1em;">$18.000</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; padding: 8px 12px; background: rgba(255, 255, 255, 0.2); border-radius: 6px;">
                                <span style="font-weight: 500;">45 kilos:</span>
                                <span style="font-weight: bold; font-size: 1.1em;">$52.000</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Calculadora de Precio Total -->
                    <div class="info-box" style="background: linear-gradient(135deg, #28a745 0%, #20c997 100%); color: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 15px rgba(40, 167, 69, 0.3);">
                        <h3 style="margin: 0 0 15px 0; font-size: 1.3em; display: flex; align-items: center; gap: 10px;">
                            <span style="font-size: 1.5em;">üßÆ</span> Total a Pagar
                        </h3>
                        <div id="precio-total-display" style="background: rgba(255, 255, 255, 0.2); padding: 15px; border-radius: 10px; text-align: center;">
                            <div style="font-size: 0.9em; margin-bottom: 8px;">Precio calculado:</div>
                            <div style="font-size: 1.8em; font-weight: bold;" id="precio-total-valor">$0</div>
                            <div style="font-size: 0.8em; margin-top: 8px; opacity: 0.9;">Se actualiza autom√°ticamente</div>
                        </div>
                    </div>
                </div>

                <form id="formCompraGas" enctype="multipart/form-data">
                    <div class="form-grid">
                        <!-- Informaci√≥n b√°sica -->
                        <div class="form-group">
                            <label for="rutGas">RUT *</label>
                            <input type="text" id="rutGas" name="rutGas" required placeholder="12.345.678-9">
                        </div>
                        <div class="form-group">
                            <label for="nombreGas">Nombre y Apellido Afiliado</label>
                            <input type="text" id="nombreGas" name="nombreGas" required>
                        </div>
                        <div class="form-group">
                            <label for="fechaCompraGas">Fecha de compra</label>
                            <input type="date" id="fechaCompraGas" name="fechaCompraGas" required>
                        </div>
                        <div class="form-group">
                            <label for="emailGas">Correo Electr√≥nico</label>
                            <input type="email" id="emailGas" name="emailGas" required>
                        </div>
                        <div class="form-group">
                            <label for="telefonoGas">Tel√©fono *</label>
                            <input type="tel" id="telefonoGas" name="telefonoGas" required placeholder="+569...">
                        </div>

                        <!-- Selector de empresa -->
                        <div class="form-group">
                            <label>Compra Lipigas</label>
                            <select id="compraLipigas" name="compraLipigas">
                                <option value="no">No</option>
                                <option value="si">S√≠</option>
                            </select>
                        </div>

                        <!-- Opciones Lipigas -->
                        <div id="lipigasOpciones" style="display:none;">
                            <div class="gas-options-container">
                                <div class="gas-option">
                                    <label class="gas-label">5 kilos</label>
                                    <div class="gas-select-container">
                                        <select id="lipigas5" name="lipigas5" class="gas-select">
                                            <option value="0">Seleccionar cantidad</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="gas-option">
                                    <label class="gas-label">11 kilos</label>
                                    <div class="gas-select-container">
                                        <select id="lipigas11" name="lipigas11" class="gas-select">
                                            <option value="0">Seleccionar cantidad</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="gas-option">
                                    <label class="gas-label">15 kilos</label>
                                    <div class="gas-select-container">
                                        <select id="lipigas15" name="lipigas15" class="gas-select">
                                            <option value="0">Seleccionar cantidad</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="gas-option">
                                    <label class="gas-label">45 kilos</label>
                                    <div class="gas-select-container">
                                        <select id="lipigas45" name="lipigas45" class="gas-select">
                                            <option value="0">Seleccionar cantidad</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            <div class="total-info">Total seleccionado: <span class="total-count">0</span></div>
                        </div>

                        <!-- Selector Abastible -->
                        <div class="form-group">
                            <label>Compra Abastible</label>
                            <select id="compraAbastible" name="compraAbastible">
                                <option value="no">No</option>
                                <option value="si">S√≠</option>
                            </select>
                        </div>

                        <!-- Opciones Abastible -->
                        <div id="abastibleOpciones" style="display:none;">
                            <div class="gas-options-container">
                                <div class="gas-option">
                                    <label class="gas-label">5 kilos</label>
                                    <div class="gas-select-container">
                                        <select id="abastible5" name="abastible5" class="gas-select">
                                            <option value="0">Seleccionar cantidad</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="gas-option">
                                    <label class="gas-label">11 kilos</label>
                                    <div class="gas-select-container">
                                        <select id="abastible11" name="abastible11" class="gas-select">
                                            <option value="0">Seleccionar cantidad</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="gas-option">
                                    <label class="gas-label">15 kilos</label>
                                    <div class="gas-select-container">
                                        <select id="abastible15" name="abastible15" class="gas-select">
                                            <option value="0">Seleccionar cantidad</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="gas-option">
                                    <label class="gas-label">45 kilos</label>
                                    <div class="gas-select-container">
                                        <select id="abastible45" name="abastible45" class="gas-select">
                                            <option value="0">Seleccionar cantidad</option>
                                        </select>
                                    </div>
                                </div>
   </div>

                        <!-- Comprobante -->
                        <div class="form-group">
                            <label for="comprobanteGas">Adjuntar comprobante de transferencia</label>
                            <input type="file" id="comprobanteGas" name="comprobanteGas" required>
                            <small>Recuerde que el asunto debe indicar cantidad y carga de gas (5k-11k-15k-45k).</small>
                        </div>
                    </div>
                    <button type="submit" class="btn btn-primary btn-enviar-gas">Enviar Compra Gas</button>
                </form>
            </div>

            <!-- Tab: Compra de Cine -->
            <div class="tab-content" id="tab-compra-cine">
                <h2>üé¨ Compra de Entradas de Cine</h2>
                <div class="info-box" style="background: #87ceed; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                    <p><strong>üìã Informaci√≥n:</strong></p>
                    <ul style="margin: 10px 0; padding-left: 20px;">
                        <li>M√°ximo 4 entradas por mes</li>
                        <li>Valor: $7.000 (incluye entrada + combo)</li>
                        <li>V√°lido en cualquier complejo Cin√©polis o Hoyts</li>
                        <li>Incluye pel√≠culas en estreno</li>
                    </ul>
                </div>
                
                <form id="formCompraCine" enctype="multipart/form-data">
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="rutCine">RUT *</label>
                            <input type="text" id="rutCine" name="rutCine" required placeholder="12.345.678-9">
                        </div>
                        
                        <div class="form-group">
                            <label for="nombreCine">Nombre y Apellido Afiliado *</label>
                            <input type="text" id="nombreCine" name="nombreCine" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="telefonoCine">Tel√©fono *</label>
                            <input type="tel" id="telefonoCine" name="telefonoCine" required placeholder="+569...">
                        </div>
                        
                        <div class="form-group">
                            <label for="emailCine">Correo Electr√≥nico *</label>
                            <input type="email" id="emailCine" name="emailCine" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="fechaCompraCine">Fecha de Compra *</label>
                            <input type="date" id="fechaCompraCine" name="fechaCompraCine" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="cantidadCine">Cantidad de Entradas *</label>
                            <select id="cantidadCine" name="cantidadCine" required>
                                <option value="0">Seleccione cantidad</option>
                                <option value="1">1 - $7.000</option>
                                <option value="2">2 - $14.000</option>
                                <option value="3">3 - $21.000</option>
                                <option value="4">4 - $28.000</option>
                            </select>
                        </div>
                        
                        <div class="form-group" style="grid-column: 1 / -1;">
                            <label for="comprobanteCine">Adjuntar Comprobante de Transferencia *</label>
                            <input type="file" id="comprobanteCine" name="comprobanteCine" required accept="image/*,.pdf">
                            <small>Formatos aceptados: JPG, PNG, PDF</small>
                        </div>
                    </div>
                    
                    <button type="submit" class="btn btn-primary btn-enviar-cine">Enviar Compra Cine</button>
                </form>
            </div>  

            <!-- Tab: Compra de Jumper Trampoline Park -->
            <div class="tab-content" id="tab-compra-jumper">
                <h2>ü§∏ Compra de Entradas Jumper Trampoline Park</h2>
                <div class="info-box" style="background: #f0d481; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                    <p><strong>üìã Informaci√≥n:</strong></p>
                    <ul style="margin: 10px 0; padding-left: 20px;">
                        <li>M√°ximo 6 entradas por mes</li>
                        <li>Valor: $6.500 </li>
                        <li>Diversi√≥n garantizada para toda la familia</li>
                        <li>Incluye acceso a todas las √°reas del parque</li>
                    </ul>
                </div>
                
                <form id="formCompraJumper" enctype="multipart/form-data">
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="rutJumper">RUT *</label>
                            <input type="text" id="rutJumper" name="rutJumper" required placeholder="12.345.678-9">
                        </div>
                        
                        <div class="form-group">
                            <label for="nombreJumper">Nombre y Apellido Afiliado *</label>
                            <input type="text" id="nombreJumper" name="nombreJumper" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="telefonoJumper">Tel√©fono *</label>
                            <input type="tel" id="telefonoJumper" name="telefonoJumper" required placeholder="+569...">
                        </div>
                        
                        <div class="form-group">
                            <label for="emailJumper">Correo Electr√≥nico *</label>
                            <input type="email" id="emailJumper" name="emailJumper" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="fechaCompraJumper">Fecha de Compra *</label>
                            <input type="date" id="fechaCompraJumper" name="fechaCompraJumper" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="cantidadJumper">Cantidad de Entradas *</label>
                            <select id="cantidadJumper" name="cantidadJumper" required>
                                <option value="0">Seleccione cantidad</option>
                                <option value="1">1 - $6.500</option>
                                <option value="2">2 - $13.000</option>
                                <option value="3">3 - $19.500</option>
                                <option value="4">4 - $26.000</option>
                                <option value="5">5 - $32.500</option>
                                <option value="6">6 - $39.000</option>
                            </select>
                        </div>
                        
                        <div class="form-group" style="grid-column: 1 / -1;">
                            <label for="comprobanteJumper">Adjuntar Comprobante de Transferencia *</label>
                            <input type="file" id="comprobanteJumper" name="comprobanteJumper" required accept="image/*,.pdf">
                            <small>Formatos aceptados: JPG, PNG, PDF</small>
                        </div>
                    </div>
                    
                    <button type="submit" class="btn btn-primary btn-enviar-jumper">Enviar Compra Jumper</button>
                </form>
            </div>

            <!-- Tab: Compra de Gimnasio -->
            <div class="tab-content" id="tab-compra-gimnasio">
                <h2>üí™ Compra de Entradas Gimnasio Energy</h2>
                <div class="info-box" style="background: #a4eb8a; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                    <p><strong>üìã Informaci√≥n:</strong></p>
                    <ul style="margin: 10px 0; padding-left: 20px;">
                        <li>M√°ximo 4 entradas por mes</li>
                        <li>Valor: $18.000 por ticket mensual</li>
                        <li>V√°lido en todas las sucursales Energy</li>
                        <li>Sin restricci√≥n de horarios</li>
                        <li>Incluye todos los servicios</li>
                    </ul>
                </div>
                
                <form id="formCompraGimnasio" enctype="multipart/form-data">
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="rutGimnasio">RUT *</label>
                            <input type="text" id="rutGimnasio" name="rutGimnasio" required placeholder="12.345.678-9">
                        </div>
                        
                        <div class="form-group">
                            <label for="nombreGimnasio">Nombre y Apellido Afiliado *</label>
                            <input type="text" id="nombreGimnasio" name="nombreGimnasio" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="telefonoGimnasio">Tel√©fono *</label>
                            <input type="tel" id="telefonoGimnasio" name="telefonoGimnasio" required placeholder="+569...">
                        </div>
                        
                        <div class="form-group">
                            <label for="emailGimnasio">Correo Electr√≥nico *</label>
                            <input type="email" id="emailGimnasio" name="emailGimnasio" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="fechaCompraGimnasio">Fecha de Compra *</label>
                            <input type="date" id="fechaCompraGimnasio" name="fechaCompraGimnasio" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="cantidadGimnasio">Cantidad de Tickets *</label>
                            <select id="cantidadGimnasio" name="cantidadGimnasio" required>
                                <option value="0">Seleccione cantidad</option>
                                <option value="1">1 - $18.000</option>
                                <option value="2">2 - $36.000</option>
                                <option value="3">3 - $54.000</option>
                                <option value="4">4 - $72.000</option>
                            </select>
                        </div>
                        
                        <div class="form-group" style="grid-column: 1 / -1;">
                            <label for="comprobanteGimnasio">Adjuntar Comprobante de Transferencia *</label>
                            <input type="file" id="comprobanteGimnasio" name="comprobanteGimnasio" required accept="image/*,.pdf">
                            <small>Formatos aceptados: JPG, PNG, PDF</small>
                        </div>
                    </div>
                    
                    <button type="submit" class="btn btn-primary btn-enviar-gimnasio">Enviar Compra Gimnasio</button>
                </form>
            </div>

            <!-- NUEVA PESTA√ëA: Pr√©stamos / Fondo Solidario -->
            <div class="tab-content" id="tab-prestamos">
                <div class="container">
                    <h2>üí∞ Pr√©stamos</h2>

                   <!-- Informaci√≥n General -->
                <div class="info-box" style="background: #e0b0f5; padding: 20px; border-radius: 12px; margin-bottom: 30px; border-left: 4px">
                    <h3 style="color: #1976D2; margin-top: 0;">üìã Informaci√≥n General</h3>
                    <p style="margin-bottom: 10px;"><strong>Requisitos b√°sicos para pr√©stamos:</strong></p>
                    <ul style="margin: 10px 0; padding-left: 20px;">
                        <li>Tener al menos 3 descuentos del Servicio de Bienestar APS</li>
                        <li>Presentar documentaci√≥n completa y vigente</li>
                        <li>Evaluaci√≥n por parte del Trabajador/a Social del Servicio</li>
                    </ul>
                </div>


                    <!-- Grid de Tipos de Pr√©stamos y Fondo -->
                    <div class="prestamos-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); gap: 25px; margin-bottom: 40px;">
                        
                        <!-- Pr√©stamos M√©dicos -->
                        <div class="prestamo-card" style="background: linear-gradient(135deg, #ff6b6b 0%, #ee5a6f 100%); color: white; padding: 25px; border-radius: 15px; box-shadow: 0 6px 20px rgba(255, 107, 107, 0.3);">
                            <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 15px;">
                                <span style="font-size: 2.5em;">üè•</span>
                                <h3 style="margin: 0; font-size: 1.4em;">Pr√©stamos M√©dicos</h3>
                            </div>
                            <div style="background: rgba(255, 255, 255, 0.2); padding: 15px; border-radius: 10px; margin-bottom: 15px;">
                                <p style="margin: 0 0 10px 0; font-weight: 500;">Caracter√≠sticas:</p>
                                <ul style="margin: 0; padding-left: 15px; list-style: none;">
                                    <li style="margin-bottom: 5px;">üíµ Tope: $500.000</li>
                                    <li style="margin-bottom: 5px;">üìÖ M√°ximo: 12 cuotas</li>
                                    <li style="margin-bottom: 5px;">‚ö° Evaluaci√≥n por Trabajador/a Social</li>
                                      <li style="margin-bottom: 5px;">üÜî Fotocopia de c√©dula de identidad</li>
                                    <li style="margin-bottom: 5px;">üìù Formulario de pr√©stamo m√©dico</li>
                                    <li style="margin-bottom: 5px;">üìã Requiere al menos 3 descuentos al Servicio de Bienestar APS</li>
                                </ul>
                            </div>
                            <button class="btn btn-primary btn-download" data-img="../assets/formulario-prestamos.png" data-name="formulario-prestamo-medico.pdf" style="width: 100%; padding: 10px; background: rgba(255, 255, 255, 0.2); border: 2px solid white; border-radius: 8px; color: white; font-weight: bold; cursor: pointer; transition: all 0.3s;">
                                üìÑ Descargar Formulario
                            </button>
                        </div>

                        <!-- Pr√©stamos de Emergencia -->
                        <div class="prestamo-card" style="background: linear-gradient(135deg, #ff9500 0%, #ff6b35 100%); color: white; padding: 25px; border-radius: 15px; box-shadow: 0 6px 20px rgba(255, 149, 0, 0.3);">
                            <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 15px;">
                                <span style="font-size: 2.5em;">üö®</span>
                                <h3 style="margin: 0; font-size: 1.4em;">Pr√©stamos de Emergencia</h3>
                            </div>
                            <div style="background: rgba(255, 255, 255, 0.2); padding: 15px; border-radius: 10px; margin-bottom: 15px;">
                                <p style="margin: 0 0 10px 0; font-weight: 500;">Caracter√≠sticas:</p>
                                <ul style="margin: 0; padding-left: 15px; list-style: none;">
                                    <li style="margin-bottom: 5px;">üíµ Tope: $500.000</li>
                                    <li style="margin-bottom: 5px;">üìÖ M√°ximo: 12 cuotas</li>
                                     <li style="margin-bottom: 5px;">‚ö° Evaluaci√≥n por Trabajador/a Social</li>
                                      <li style="margin-bottom: 5px;">üÜî Fotocopia de c√©dula de identidad</li>
                                     <li style="margin-bottom: 5px;">üìù Formulario de pr√©stamo de emergencia</li>
                                   <li style="margin-bottom: 5px;">üìã Requiere al menos 3 descuentos al Servicio de Bienestar APS</li>
                                </ul>
                            </div>
                            <button class="btn btn-primary btn-download" data-img="../assets/formulario-prestamos.png" data-name="formulario-prestamo-emergencia.pdf" style="width: 100%; padding: 10px; background: rgba(255, 255, 255, 0.2); border: 2px solid white; border-radius: 8px; color: white; font-weight: bold; cursor: pointer; transition: all 0.3s;">
                                üìÑ Descargar Formulario
                            </button>
                        </div>

                        <!-- Pr√©stamo Libre Disposici√≥n -->
                        <div class="prestamo-card" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); color: white; padding: 25px; border-radius: 15px; box-shadow: 0 6px 20px rgba(79, 172, 254, 0.3);">
                            <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 15px;">
                                <span style="font-size: 2.5em;">üí≥</span>
                                <h3 style="margin: 0; font-size: 1.4em;">Pr√©stamo Libre Disposici√≥n</h3>
                            </div>
                            <div style="background: rgba(255, 255, 255, 0.2); padding: 15px; border-radius: 10px; margin-bottom: 15px;">
                                <p style="margin: 0 0 10px 0; font-weight: 500;">Caracter√≠sticas:</p>
                                <ul style="margin: 0; padding-left: 15px; list-style: none;">
                                    <li style="margin-bottom: 5px;">üíµ Tope: $300.000</li>
                                    <li style="margin-bottom: 5px;">üìÖ M√°ximo: 6 cuotas</li>
                                    <li style="margin-bottom: 5px;">üìã Requiere las √∫ltimas 3 liquidaciones</li>
                                    <li style="margin-bottom: 5px;">üÜî Fotocopia de c√©dula de identidad</li>
                                    <li style="margin-bottom: 5px;">üìù Formulario de pr√©stamo de libre disposici√≥n</li>
                                </ul>
                            </div>
                            <button class="btn btn-primary btn-download" data-img="../assets/formulario-prestamos-libre-disposicion.png" data-name="formulario-prestamo-libre-disposicion.pdf" style="width: 100%; padding: 10px; background: rgba(255, 255, 255, 0.2); border: 2px solid white; border-radius: 8px; color: white; font-weight: bold; cursor: pointer; transition: all 0.3s;">
                                üìÑ Descargar Formulario
                            </button>
                        </div>
</div>

                <!-- Formulario de Solicitud -->
                <div class="solicitud-section" style="background: #f8f9fa; padding: 30px; border-radius: 15px; margin-top: 30px;">
                    <h3 style="color: #495057; margin-bottom: 20px; text-align: center;">üìã Solicitar Pr√©stamo</h3>
                    
                    <form id="formSolicitudPrestamo" enctype="multipart/form-data">
                        <div class="form-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
                            
                            <!-- Informaci√≥n Personal -->
                            <div class="form-group">
                                <label for="rutPrestamo">RUT del Afiliado *</label>
                                <input type="text" id="rutPrestamo" name="rutPrestamo" required placeholder="12.345.678-9" style="width: 100%; padding: 12px; border: 2px solid #e9ecef; border-radius: 8px;">
                            </div>
                            
                            <div class="form-group">
                                <label for="nombrePrestamo">Nombre Completo *</label>
                                <input type="text" id="nombrePrestamo" name="nombrePrestamo" required style="width: 100%; padding: 12px; border: 2px solid #e9ecef; border-radius: 8px;">
                            </div>
                            
                            <div class="form-group">
                                <label for="emailPrestamo">Correo Electr√≥nico *</label>
                                <input type="email" id="emailPrestamo" name="emailPrestamo" required style="width: 100%; padding: 12px; border: 2px solid #e9ecef; border-radius: 8px;">
                            </div>
                            
                            <div class="form-group">
                                <label for="telefonoPrestamo">Tel√©fono *</label>
                                <input type="tel" id="telefonoPrestamo" name="telefonoPrestamo" required placeholder="+569..." style="width: 100%; padding: 12px; border: 2px solid #e9ecef; border-radius: 8px;">
                            </div>
                            
                            <!-- Tipo de Solicitud -->
                            <div class="form-group">
                                <label for="tipoSolicitud">Tipo de Solicitud *</label>
                                <select id="tipoSolicitud" name="tipoSolicitud" required style="width: 100%; padding: 12px; border: 2px solid #e9ecef; border-radius: 8px;">
                                    <option value="">Seleccione tipo de solicitud</option>
                                    <option value="prestamo-medico">Pr√©stamo M√©dico</option>
                                    <option value="prestamo-emergencia">Pr√©stamo de Emergencia</option>
                                    <option value="prestamo-libre-disposicion">Pr√©stamo de Libre Disposici√≥n</option>
                                </select>
                            </div>

                            <!-- Descripci√≥n de la solicitud -->
                            <div class="form-group" style="grid-column: 1 / -1;">
                                <label for="descripcionSolicitud">Descripci√≥n de la Solicitud *</label>
                                <textarea id="descripcionSolicitud" name="descripcionSolicitud" required rows="4" placeholder="Describa detalladamente el motivo de su solicitud..." style="width: 100%; padding: 12px; border: 2px solid #e9ecef; border-radius: 8px; resize: vertical;"></textarea>
                            </div>
                        </div>
                        
                        <!-- Documentos Requeridos -->
                        <div class="documentos-section" style="margin-top: 30px;">
                            <h4 style="color: #495057; margin-bottom: 20px;">üìé Documentos Requeridos</h4>
                            <div class="documentos-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
                                
                                <div class="form-group">
                                    <label for="formularioCompleto">Formulario Completo y Firmado *</label>
                                    <input type="file" id="formularioCompleto" name="formularioCompleto" required accept=".pdf,.jpg,.jpeg,.png" style="width: 100%; padding: 12px; border: 2px solid #e9ecef; border-radius: 8px;">
                                    <small style="color: #6c757d;">Formulario descargado y completado del tipo de pr√©stamo seleccionado</small>
                                </div>
                                
                                <div class="form-group">
                                    <label for="cedulaIdentidad">Fotocopia C√©dula de Identidad *</label>
                                    <input type="file" id="cedulaIdentidad" name="cedulaIdentidad" required accept=".pdf,.jpg,.jpeg,.png" style="width: 100%; padding: 12px; border: 2px solid #e9ecef; border-radius: 8px;">
                                    <small style="color: #6c757d;">Ambas caras de la c√©dula en un solo archivo</small>
                                </div>
                                
                                <div class="form-group">
                                    <label for="liquidacionesSueldo">√öltimas 3 Liquidaciones de Sueldo *</label>
                                    <input type="file" id="liquidacionesSueldo" name="liquidacionesSueldo" required accept=".pdf,.jpg,.jpeg,.png" multiple style="width: 100%; padding: 12px; border: 2px solid #e9ecef; border-radius: 8px;">
                                    <small style="color: #6c757d;">Puede seleccionar m√∫ltiples archivos</small>
                                </div>
                                
                                <!-- Documentos adicionales seg√∫n tipo -->
                                <div class="form-group" id="documentosAdicionales" style="display: none;">
                                    <label for="documentosExtras">Documentos Adicionales</label>
                                    <input type="file" id="documentosExtras" name="documentosExtras" accept=".pdf,.jpg,.jpeg,.png" multiple style="width: 100%; padding: 12px; border: 2px solid #e9ecef; border-radius: 8px;">
                                    <small id="documentosExtrasInfo" style="color: #6c757d;"></small>
                                </div>
                            </div>
                        </div>
                        
                        <div style="text-align: center; margin-top: 30px;">
                            <button type="submit" class="btn btn-primary btn-enviar-prestamo" style="padding: 15px 40px; font-size: 1.1em; font-weight: 600; background: linear-gradient(135deg, #007bff, #0056b3); border: none; border-radius: 10px; color: white; cursor: pointer; transition: all 0.3s;">
                                üì§ Enviar Solicitud de Pr√©stamo
                            </button>
                        </div>
                    </form>
                </div>
            </div> 
          </div> 
            <!-- Tab: Solicitudes -->
          <div class="tab-content" id="tab-solicitudes">
                <h2>üìù Mis Solicitudes</h2>
                    
                    <div id="listaSolicitudes">
                        <!-- Aqu√≠ se cargan din√°micamente las solicitudes -->
                        <p>Cargando solicitudes...</p>
                    </div>
                </div>
                </div>
          <!-- Tab: Mi Perfil -->
            <div class="tab-content" id="tab-perfil">
                <h2>‚öôÔ∏è Mi Perfil</h2>
                <div class="profile-grid">
                    <div class="profile-card">
                        <h3>Informaci√≥n Personal</h3>
                        <form class="profile-form">
                            <div class="form-group">
                                <label>Nombre Completo</label>
                                <input type="text" readonly>
                            </div>
                            <div class="form-group">
                                <label>RUT</label>
                                <input type="text" readonly>
                            </div>
                            <div class="form-group">
                                <label>Email</label>
                                <input type="email">
                            </div>
                            <div class="form-group">
                                <label>Tel√©fono</label>
                                <input type="tel">
                            </div>
                            <button type="submit" class="btn btn-primary">Actualizar Informaci√≥n</button>
                        </form>
                    </div>
                    <div class="profile-card">
                        <h3>Cambiar Contrase√±a</h3>
                        <form class="profile-form">
                            <div class="form-group">
                                <label>Contrase√±a Actual</label>
                                <input type="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                            </div>
                            <div class="form-group">
                                <label>Nueva Contrase√±a</label>
                                <input type="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                            </div>
                            <div class="form-group">
                                <label>Confirmar Contrase√±a</label>
                                <input type="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                            </div>
                            <button type="submit" class="btn btn-primary">Cambiar Contrase√±a</button>
                        </form>
                    </div>
                    <div class="profile-card">
                        <h3>Informaci√≥n de Cuenta</h3>
                        <div class="info-list">
                            <div class="info-item">
                                <span class="info-label">Fecha de afiliaci√≥n:</span>
                                <span class="info-value"></span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">Centro de Salud:</span>
                                <span class="info-value"></span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">Cargas familiares:</span>
                                <span class="info-value"></span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">Estado:</span>
                                <span class="badge success"></span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
    
    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <p>&copy; 2025 Servicio Bienestar APS - Corporaci√≥n Municipal de Puente Alto</p>
        </div>
    </footer>  
    
    <!-- SCRIPTS ACTUALIZADOS CON CALCULADORA DE PRECIOS -->
    <script type="module" src="../js/dashboard-afiliado-firebase.js"></script>
    <script type="module" src="../js/compras-unificadas.js"></script>

    <script type="module">
        // Importar m√≥dulos SIN CORS para pr√©stamos
        import '../js/prestamos-firebase.js';
        import '../js/prestamos.js';

        // ========================================
        // CALCULADORA DE PRECIOS PARA GAS
        // ========================================
        
        // Precios definidos seg√∫n Firebase
        const PRECIOS_GAS = {
            lipigas: {
                kg5: 7000,
                kg11: 12000,
                kg15: 16000,
                kg45: 54000
            },
            abastible: {
                kg5: 8000,
                kg11: 15000,
                kg15: 18000,
                kg45: 52000
            }
        };

        // Funci√≥n para calcular precio total
        function calcularPrecioTotal() {
            let total = 0;
            
            // Calcular Lipigas
            if (document.getElementById('compraLipigas').value === 'si') {
                total += (parseInt(document.getElementById('lipigas5').value) || 0) * PRECIOS_GAS.lipigas.kg5;
                total += (parseInt(document.getElementById('lipigas11').value) || 0) * PRECIOS_GAS.lipigas.kg11;
                total += (parseInt(document.getElementById('lipigas15').value) || 0) * PRECIOS_GAS.lipigas.kg15;
                total += (parseInt(document.getElementById('lipigas45').value) || 0) * PRECIOS_GAS.lipigas.kg45;
            }
            
            // Calcular Abastible
            if (document.getElementById('compraAbastible').value === 'si') {
                total += (parseInt(document.getElementById('abastible5').value) || 0) * PRECIOS_GAS.abastible.kg5;
                total += (parseInt(document.getElementById('abastible11').value) || 0) * PRECIOS_GAS.abastible.kg11;
                total += (parseInt(document.getElementById('abastible15').value) || 0) * PRECIOS_GAS.abastible.kg15;
                total += (parseInt(document.getElementById('abastible45').value) || 0) * PRECIOS_GAS.abastible.kg45;
            }
            
            // Actualizar display
            const precioDisplay = document.getElementById('precio-total-valor');
            if (precioDisplay) {
                precioDisplay.textContent = `$${total.toLocaleString('es-CL')}`;
                
                // Animar el cambio
                precioDisplay.style.transform = 'scale(1.1)';
                precioDisplay.style.color = total > 0 ? '#fff' : '#ccc';
                
                setTimeout(() => {
                    precioDisplay.style.transform = 'scale(1)';
                }, 200);
            }
            
            return total;
        }

        // Agregar event listeners para calcular autom√°ticamente
        document.addEventListener('DOMContentLoaded', function() {
            // Event listeners para selectores de Lipigas
            ['lipigas5', 'lipigas11', 'lipigas15', 'lipigas45'].forEach(id => {
                const elemento = document.getElementById(id);
                if (elemento) {
                    elemento.addEventListener('change', calcularPrecioTotal);
                }
            });
            
            // Event listeners para selectores de Abastible
            ['abastible5', 'abastible11', 'abastible15', 'abastible45'].forEach(id => {
                const elemento = document.getElementById(id);
                if (elemento) {
                    elemento.addEventListener('change', calcularPrecioTotal);
                }
            });
            
            // Event listeners para los toggles principales
            const compraLipigas = document.getElementById('compraLipigas');
            if (compraLipigas) {
                compraLipigas.addEventListener('change', function() {
                    calcularPrecioTotal();
                    // Mostrar/ocultar opciones
                    const opciones = document.getElementById('lipigasOpciones');
                    if (opciones) {
                        opciones.style.display = this.value === 'si' ? 'block' : 'none';
                    }
                });
            }
            
            const compraAbastible = document.getElementById('compraAbastible');
            if (compraAbastible) {
                compraAbastible.addEventListener('change', function() {
                    calcularPrecioTotal();
                    // Mostrar/ocultar opciones
                    const opciones = document.getElementById('abastibleOpciones');
                    if (opciones) {
                        opciones.style.display = this.value === 'si' ? 'block' : 'none';
                    }
                });
            }
            
            // Inicial
            calcularPrecioTotal();
        });

        // Sistema de pesta√±as mejorado
        const tabs = document.querySelectorAll('.nav-tab');
        const tabContents = document.querySelectorAll('.tab-content');
        
        tabs.forEach(tab => {
            tab.addEventListener('click', function() {
                const targetTab = this.getAttribute('data-tab');
                
                // Remover clase active de todas las pesta√±as
                tabs.forEach(t => t.classList.remove('active'));
                tabContents.forEach(content => content.classList.remove('active'));
                
                // Agregar clase active a la pesta√±a clickeada
                this.classList.add('active');
                
                // Mostrar el contenido correspondiente
                const targetContent = document.getElementById(`tab-${targetTab}`);
                if (targetContent) {
                    targetContent.classList.add('active');
                }
            });
        });

        // Funci√≥n para nueva solicitud
        function nuevaSolicitud() {
            console.log('Nueva solicitud clickeada');
        }

        // Funci√≥n para logout
        function logout() {
            if (confirm('¬øEst√° seguro que desea cerrar sesi√≥n?')) {
                sessionStorage.clear();
                localStorage.clear();
                window.location.href = '../index.html';
            }
        }

        // Funci√≥n para filtrar solicitudes
        function filtrarSolicitudes(tipo) {
            console.log('Filtrando solicitudes:', tipo);
        }

        // Hacer las funciones globales
        window.nuevaSolicitud = nuevaSolicitud;
        window.logout = logout;
        window.filtrarSolicitudes = filtrarSolicitudes;
        window.calcularPrecioTotal = calcularPrecioTotal;

        // Agregar estado de env√≠o si no existe
        document.addEventListener('DOMContentLoaded', function() {
            const form = document.getElementById('formSolicitudPrestamo');
            if (form && !document.getElementById('estadoEnvio')) {
                const estadoDiv = document.createElement('div');
                estadoDiv.id = 'estadoEnvio';
                estadoDiv.style.cssText = `
                    margin: 20px 0;
                    padding: 15px;
                    border-radius: 8px;
                    font-weight: bold;
                    text-align: center;
                    display: none;
                `;
                form.appendChild(estadoDiv);
            }

            // Mostrar estado de env√≠o cuando sea necesario
            const originalStyle = document.getElementById('estadoEnvio')?.style;
            if (originalStyle) {
                const observer = new MutationObserver(function(mutations) {
                    mutations.forEach(function(mutation) {
                        if (mutation.type === 'childList' || mutation.type === 'characterData') {
                            const estadoEl = document.getElementById('estadoEnvio');
                            if (estadoEl && estadoEl.innerHTML.trim()) {
                                estadoEl.style.display = 'block';
                            }
                        }
                    });
                });
                
                const estadoEl = document.getElementById('estadoEnvio');
                if (estadoEl) {
                    observer.observe(estadoEl, { 
                        childList: true, 
                        characterData: true, 
                        subtree: true 
                    });
                }
            }
        });
    </script>

    <!-- Librer√≠as para generar PDF (mantenidas para descargas de formularios) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
</body>
</html>
